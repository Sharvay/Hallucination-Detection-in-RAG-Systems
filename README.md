# Hallucination-Detection-in-RAG-Systems

This project detects hallucinated spans in answers generated by language models using a token-level classifier based on ModernBERT. It supports QA-style prompts and integrates a retrieval and generation pipeline using BM25/FAISS for retrieval and T5 for generation. A Streamlit UI is included for interactive hallucination detection.

---

## ğŸ“ Folder Structure

```bash
.
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ app.py                  # Streamlit UI
â”‚   â””â”€â”€ model_code.py           # Hallucination detection logic (non-class structure)
â”‚
â”œâ”€â”€ Data/
â”‚   â”œâ”€â”€ response.json           # Model-generated responses
â”‚   â”œâ”€â”€ source_info.jsonl       # Source passages (jsonl)
â”‚
â”œâ”€â”€ model/M05/                  # Saved ModernBERT model
â”‚   â””â”€â”€ config.json, model.safetensors, tokenizer files...
â”‚
â”œâ”€â”€ notebooks/
â”‚   â”œâ”€â”€ hallucination_detector_training.ipynb  # Training notebook
â”‚   â”œâ”€â”€ inference_demo.ipynb                   # Inference examples
â”‚   â””â”€â”€ Retriver_Generator.ipynb               # End-to-end retrieval + generation
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ data_utils.py           # Load & format dataset
â”‚   â”œâ”€â”€ eval_utils.py           # Metrics for hallucination span detection
â”‚   â”œâ”€â”€ hallucination_dataset.py # PyTorch Dataset with token labels
â”‚   â”œâ”€â”€ main_train.py           # Training loop and data loader setup
â”‚   â”œâ”€â”€ predict.py              # Predict hallucinated spans from prompt/answer
â”‚   â”œâ”€â”€ retriever.py            # BM25 retriever using sklearn + TfidfVectorizer
â”‚   â”œâ”€â”€ generator.py            # T5 answer generation from context
â”‚
â”œâ”€â”€ README.md
â”œâ”€â”€ requirements.txt
```

## How It Works

1. **Retrieval**: Given a question, retrieve relevant passages using BM25.
2. **Generation**: Use T5 to answer the question using the retrieved passages.
3. **Detection**: Run hallucination detector to find unsupported answer spans.
4. **Highlight**: See hallucinated parts in red using the Streamlit app.

---

## Model

The token classification model is based on `answerdotai/ModernBERT-base` and fine-tuned on the [RAGTruth dataset](https://huggingface.co/datasets/wandb/RAGTruth-processed). Labels:
- `0`: Supported token
- `1`: Hallucinated token

---

